<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORIGAMI — Residual Reconstruction from Interpolated Priors</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: #333;
            background: #fff;
            overflow-x: hidden;
        }
        a { color: #17a2b8; text-decoration: none; }
        a:hover { text-decoration: underline; }

        /* ── Nav Bar ── */
        .navbar {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #1a1a2e;
            padding: 0 24px;
            display: flex;
            align-items: center;
            height: 48px;
            gap: 24px;
        }
        .navbar .brand {
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            letter-spacing: 2px;
        }
        .navbar nav {
            display: flex;
            gap: 16px;
            margin-left: auto;
        }
        .navbar nav a {
            color: #8ecae6;
            font-size: 14px;
            white-space: nowrap;
        }
        .navbar nav a:hover { color: #fff; text-decoration: none; }

        /* ── Hero ── */
        .hero {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            padding: 64px 24px 48px;
            text-align: center;
            color: #fff;
        }
        .hero h1 {
            font-size: 56px;
            font-weight: 800;
            letter-spacing: 4px;
            margin-bottom: 12px;
        }
        .hero .subtitle {
            font-size: 22px;
            color: #8ecae6;
            font-weight: 500;
            margin-bottom: 16px;
        }
        .hero .tagline {
            font-size: 20px;
            opacity: 0.85;
            max-width: 720px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* ── Section shared ── */
        .section {
            padding: 64px 24px;
        }
        .section.light {
            background: #f5f5f5;
        }
        .section-title {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
            color: #1a1a2e;
        }
        .section-desc {
            text-align: center;
            font-size: 16px;
            color: #555;
            max-width: 640px;
            margin: 0 auto 40px;
            line-height: 1.6;
        }

        /* ── Deep Zoom Viewer ── */
        .viewer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            max-width: 1200px;
            margin: 0 auto 24px;
        }
        .viewer-panel {
            position: relative;
            border-radius: 8px;
            height: 500px;
            background: #111;
            overflow: hidden;
        }
        .viewer-panel .osd-container {
            width: 100%;
            height: 100%;
        }
        .viewer-header {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .viewer-header select {
            background: rgba(0,0,0,0.85);
            color: #fff;
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }
        .viewer-header select:hover { border-color: #888; }
        .viewer-header .size-tag {
            background: rgba(0,0,0,0.7);
            color: #8ecae6;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            pointer-events: none;
            white-space: nowrap;
        }

        /* ── How It Works ── */
        .steps-row {
            display: flex;
            gap: 24px;
            max-width: 1000px;
            margin: 0 auto 40px;
            justify-content: center;
        }
        .step-card {
            flex: 1;
            max-width: 300px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 28px 24px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        .step-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #17a2b8;
            color: #fff;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 14px;
        }
        .step-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #1a1a2e;
        }
        .step-card p {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
        }
        .figure-embed {
            text-align: center;
            max-width: 720px;
            margin: 0 auto 16px;
        }
        .figure-embed img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .figure-embed .caption {
            font-size: 12px;
            color: #6c757d;
            margin-top: 8px;
        }
        .section-link {
            text-align: center;
            margin-top: 16px;
        }
        .section-link a {
            font-size: 15px;
            font-weight: 600;
        }

        /* ── Results ── */
        .charts-row {
            display: flex;
            gap: 24px;
            max-width: 960px;
            margin: 0 auto 32px;
            justify-content: center;
        }
        .chart-card {
            flex: 1;
            max-width: 460px;
        }
        .chart-card img {
            width: 100%;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .chart-card .caption {
            font-size: 12px;
            color: #6c757d;
            margin-top: 6px;
            text-align: center;
        }
        .results-table {
            max-width: 740px;
            margin: 0 auto;
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .results-table th {
            background: #e9ecef;
            padding: 10px 14px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
        }
        .results-table td {
            padding: 10px 14px;
            border-bottom: 1px solid #e9ecef;
        }
        .results-table tr.highlight td {
            background: #d4edda;
            font-weight: 500;
        }
        .results-table tr.baseline td {
            background: #fff3cd;
        }

        /* ── Metrics Grid ── */
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .metric-card img {
            width: 100%;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        /* ── Docs & Resources ── */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 960px;
            margin: 0 auto;
        }
        .resource-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 24px 20px;
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .resource-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        .resource-card h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #1a1a2e;
        }
        .resource-card p {
            font-size: 13px;
            color: #555;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        .resource-card a {
            font-size: 13px;
            font-weight: 600;
        }

        /* ── Footer ── */
        .footer {
            background: #1a1a2e;
            color: rgba(255,255,255,0.6);
            padding: 40px 24px;
            text-align: center;
            font-size: 14px;
        }
        .footer .title {
            font-size: 16px;
            color: rgba(255,255,255,0.85);
            margin-bottom: 12px;
            font-weight: 500;
        }
        .footer a { color: #8ecae6; }
        .footer .links {
            margin-top: 8px;
        }
        .footer .links span {
            margin: 0 8px;
            opacity: 0.4;
        }

        /* ── Responsive ── */
        @media (max-width: 768px) {
            .hero h1 { font-size: 36px; letter-spacing: 2px; }
            .hero .subtitle { font-size: 18px; }
            .hero .tagline { font-size: 16px; }
            .viewer-grid { grid-template-columns: 1fr; }
            .viewer-panel { height: 200px; }
            .steps-row { flex-direction: column; align-items: center; }
            .step-card { max-width: 100%; }
            .charts-row { flex-direction: column; align-items: center; }
            .chart-card { max-width: 100%; }
            .metrics-grid { grid-template-columns: 1fr; }
            .resources-grid { grid-template-columns: 1fr; }
            .navbar nav { gap: 10px; }
            .navbar nav a { font-size: 12px; }
        }
    </style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- NAV BAR                                                           -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="navbar">
    <div class="brand">ORIGAMI</div>
    <nav>
        <a href="#viewer">Viewer</a>
        <a href="#how-it-works">How It Works</a>
        <a href="#results">Results</a>
        <a href="/pipeline.html">Pipeline</a>
        <a href="/comparison.html">Comparison</a>
        <a href="#docs">Docs</a>
    </nav>
</div>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- HERO                                                              -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="hero">
    <h1>ORIGAMI</h1>
    <div class="subtitle">Residual Reconstruction from Interpolated Priors</div>
    <div class="tagline">
        Store a compact residual pyramid instead of full-resolution tiles.
        The server reconstructs and caches tiles as JPEG on first request.
    </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- DEEP ZOOM VIEWER PLACEHOLDER                                      -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="section light" id="viewer">
    <div class="section-title">Interactive Deep Zoom Comparison</div>
    <div class="section-desc">
        Both viewers are served by the same tile server. JPEG slides store pre-encoded tiles on disk.
        ORIGAMI slides store a compact residual pyramid &mdash; the server reconstructs and caches tiles as JPEG on first request.
        Pan and zoom are synchronized. Scroll to zoom, drag to pan.
    </div>

    <div class="viewer-grid">
        <div class="viewer-panel">
            <div class="viewer-header">
                <select id="sel-left"></select>
                <span id="size-left" class="size-tag"></span>
            </div>
            <div id="osd-left" class="osd-container"></div>
        </div>
        <div class="viewer-panel">
            <div class="viewer-header">
                <select id="sel-right"></select>
                <span id="size-right" class="size-tag"></span>
            </div>
            <div id="osd-right" class="osd-container"></div>
        </div>
    </div>

    <div style="max-width: 1200px; margin: 16px auto 0; font-size: 12px; color: #6c757d; line-height: 1.6;">
        <p style="margin-bottom: 4px;">
            <strong>Source:</strong> 3DHISTECH-1 &mdash; small intestine, brightfield, H&amp;E stain. Scanned on a 3DHISTECH Pannoramic 1000.
            DICOM JPEG tiles encoded with Intel IPP JPEG encoder at approximately Q91.
            From the <a href="https://openslide.cs.cmu.edu/download/openslide-testdata/DICOM/" target="_blank" rel="noopener">OpenSlide DICOM test data</a> collection (CC0-1.0).
            57,344 &times; 60,416 pixels.
        </p>
        <p style="margin-bottom: 4px;">
            <strong>JPEG baseline (left):</strong> Raw JPEG tiles extracted directly from the DICOM encapsulated pixel data &mdash; untouched original bytes from the scanner.
            Lower pyramid levels are generated by downsampling.
            388 MB total on disk.
        </p>
        <p>
            <strong>ORIGAMI (right):</strong> GPU-encoded on NVIDIA B200 in 25 seconds.
            Stores L2 baseline tiles (Q80, 4:4:4) plus Y-channel residuals (L1 Q60, L0 Q40) with OptL2 &plusmn;15 and decode-phase unsharp mask (0.5).
            L1 and L0 tiles are reconstructed on demand by the tile server from the L2 baseline and residual data.
            91 MB total on disk (29 MB L2 + 62 MB residuals).
        </p>
    </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- HOW IT WORKS                                                      -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="section" id="how-it-works">
    <div class="section-title">How It Works</div>
    <div class="section-desc">
        ORIGAMI exploits inter-scale redundancy in image pyramids. Instead of storing every tile independently, it stores compact prediction errors.
    </div>

    <div class="steps-row">
        <div class="step-card">
            <div class="step-num">1</div>
            <h3>Store the Pyramid</h3>
            <p>On disk: one JPEG L2 tile (256x256) plus grayscale luma residuals for 4 L1 and 16 L0 tiles &mdash; a fraction of the size of storing every tile independently.</p>
        </div>
        <div class="step-card">
            <div class="step-num">2</div>
            <h3>Reconstruct on Demand</h3>
            <p>When a tile is requested, the server upsamples the L2 parent, applies residuals, and encodes as JPEG &mdash; all in ~1ms per tile.</p>
        </div>
        <div class="step-card">
            <div class="step-num">3</div>
            <h3>Cache &amp; Serve</h3>
            <p>Reconstructed tiles are cached in memory and on disk. Subsequent requests hit the cache at sub-millisecond latency, indistinguishable from static JPEG serving.</p>
        </div>
    </div>

    <div class="section-link">
        <a href="/pipeline.html">Explore the full pipeline walkthrough &rarr;</a>
    </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- RESULTS                                                           -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="section light" id="results">
    <div class="section-title">Visual Quality vs Size</div>
    <div class="section-desc">
        Each chart compares a single 1024x1024 tile family (1 L2 + 4 L1 + 16 L0 tiles) across matched operating points.
        JPEG labels show the quality setting (Q30&ndash;Q90). ORIGAMI labels show the L1/L0 residual quality split
        with a fixed L2 baseline of Q90, 4:4:4 chroma, OptL2 &plusmn;20.
        At every operating point ORIGAMI delivers higher quality at smaller size.
    </div>

    <div class="metrics-grid">
        <div class="metric-card">
            <img src="/charts/homepage/psnr_vs_size.png" alt="PSNR vs Size">
        </div>
        <div class="metric-card">
            <img src="/charts/homepage/ssim_vs_size.png" alt="SSIM vs Size">
        </div>
        <div class="metric-card">
            <img src="/charts/homepage/vif_vs_size.png" alt="VIF vs Size">
        </div>
        <div class="metric-card">
            <img src="/charts/homepage/delta_e_vs_size.png" alt="Delta E vs Size">
        </div>
        <div class="metric-card">
            <img src="/charts/homepage/lpips_vs_size.png" alt="LPIPS vs Size">
        </div>
    </div>

    <div class="section-link" style="margin-top: 24px;">
        <a href="/comparison.html">Open the full comparison viewer &rarr;</a>
    </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- DOCUMENTATION & RESOURCES                                         -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="section" id="docs">
    <div class="section-title">Documentation &amp; Resources</div>
    <div class="section-desc">
        Technical papers, interactive tools, and implementation details.
    </div>

    <div class="resources-grid">
        <a class="resource-card" href="/paper/origami_paper_article.pdf">
            <h3>Paper (PDF)</h3>
            <p>Full academic paper with methodology, evaluation, and results.</p>
            <span>Read paper &rarr;</span>
        </a>
        <a class="resource-card" href="/paper/Executive_Summary.md">
            <h3>Executive Summary</h3>
            <p>Key metrics and the business case for ORIGAMI.</p>
            <span>Read summary &rarr;</span>
        </a>
        <a class="resource-card" href="/pipeline.html">
            <h3>Pipeline Walkthrough</h3>
            <p>Step-by-step encode pipeline with debug images from real runs.</p>
            <span>Explore pipeline &rarr;</span>
        </a>
        <a class="resource-card" href="/comparison.html">
            <h3>Comparison Viewer</h3>
            <p>Interactive A/B quality analysis across encoders and configs.</p>
            <span>Open viewer &rarr;</span>
        </a>
        <a class="resource-card" href="/docs/encode_time_optimizations.md">
            <h3>Encode Optimizations</h3>
            <p>Technical deep-dive on every design decision and its impact.</p>
            <span>Read details &rarr;</span>
        </a>
        <a class="resource-card" href="https://github.com/andrewluetgers" target="_blank" rel="noopener">
            <h3>GitHub</h3>
            <p>Source code, build instructions, and contribution guide.</p>
            <span>View source &rarr;</span>
        </a>
    </div>
</div>

<!-- ═══════════════════════════════════════════════════════════════════ -->
<!-- FOOTER                                                            -->
<!-- ═══════════════════════════════════════════════════════════════════ -->
<div class="footer">
    <div class="title">ORIGAMI &mdash; Efficient Whole-Slide Image Serving Through Residual Reconstruction</div>
    <div class="links">
        MIT License
        <span>|</span>
        <a href="https://github.com/andrewluetgers" target="_blank" rel="noopener">GitHub</a>
        <span>|</span>
        Andrew Luetgers
    </div>
</div>

<!-- OpenSeadragon -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    // Smooth scroll for anchor links
    document.querySelectorAll('.navbar nav a[href^="#"]').forEach(link => {
        link.addEventListener('click', e => {
            const target = document.querySelector(link.getAttribute('href'));
            if (target) {
                e.preventDefault();
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });

    // Deep Zoom 2-up viewer with slide pickers
    (function() {
        var DZI_SERVER = 'http://localhost:3007';
        var DEFAULT_LEFT = 'jpeg90';
        var DEFAULT_RIGHT = 'origami_b80_60_40';

        var slides = [];
        var viewers = { left: null, right: null };
        var syncing = false;

        var osdOpts = {
            prefixUrl: 'https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/',
            showNavigator: false,
            animationTime: 0.6,
            springStiffness: 12,
            visibilityRatio: 1.0,
            constrainDuringPan: false,
            immediateRender: false,
            blendTime: 0.15,
            maxZoomPixelRatio: 2,
            pixelsPerWheelLine: 60,
            zoomPerScroll: 1.2,
            zoomPerClick: 2.0,
            minZoomImageRatio: 0.5,
            maxZoomLevel: 40,
            gestureSettingsMouse: { flickEnabled: true, flickMinSpeed: 180, flickMomentum: 0.15,
                dragToPan: true, scrollToZoom: true, clickToZoom: true, dblClickToZoom: true, pinchToZoom: true },
            gestureSettingsTouch: { flickEnabled: true, flickMinSpeed: 120, flickMomentum: 0.15,
                dragToPan: true, scrollToZoom: false, clickToZoom: false, dblClickToZoom: true, pinchToZoom: true },
        };

        function syncTo(src, dst) {
            if (syncing) return;
            syncing = true;
            dst.viewport.panTo(src.viewport.getCenter(false), false);
            dst.viewport.zoomTo(src.viewport.getZoom(false), null, false);
            syncing = false;
        }

        function updateSizeLabel(side, slideId) {
            var slide = slides.find(function(s) { return s.id === slideId; });
            var el = document.getElementById('size-' + side);
            el.textContent = slide ? slide.disk_size_mb.toFixed(0) + ' MB on disk' : '';
        }

        function createViewer(side, slideId) {
            var other = side === 'left' ? 'right' : 'left';
            // Save current position from existing viewer
            var savedCenter = null, savedZoom = null;
            if (viewers[other]) {
                savedCenter = viewers[other].viewport.getCenter(false);
                savedZoom = viewers[other].viewport.getZoom(false);
            } else if (viewers[side]) {
                savedCenter = viewers[side].viewport.getCenter(false);
                savedZoom = viewers[side].viewport.getZoom(false);
            }

            if (viewers[side]) {
                viewers[side].destroy();
            }

            var v = OpenSeadragon(Object.assign({
                id: 'osd-' + side,
                showNavigator: side === 'left',
                tileSources: DZI_SERVER + '/dzi/' + slideId + '.dzi'
            }, osdOpts));

            v.addHandler('zoom', function() {
                var otherV = viewers[other];
                if (otherV) syncTo(v, otherV);
            });
            v.addHandler('pan', function() {
                var otherV = viewers[other];
                if (otherV) syncTo(v, otherV);
            });

            // Restore position once loaded
            if (savedCenter && savedZoom) {
                v.addOnceHandler('open', function() {
                    syncing = true;
                    v.viewport.panTo(savedCenter, true);
                    v.viewport.zoomTo(savedZoom, null, true);
                    syncing = false;
                });
            }

            viewers[side] = v;
            updateSizeLabel(side, slideId);
        }

        function populateSelect(side, defaultId) {
            var sel = document.getElementById('sel-' + side);
            sel.innerHTML = '';
            for (var i = 0; i < slides.length; i++) {
                var opt = document.createElement('option');
                opt.value = slides[i].id;
                opt.textContent = slides[i].label + ' (' + slides[i].disk_size_mb.toFixed(0) + ' MB)';
                sel.appendChild(opt);
            }
            if (defaultId && slides.find(function(s) { return s.id === defaultId; })) {
                sel.value = defaultId;
            }
            sel.onchange = function() {
                createViewer(side, sel.value);
                // Persist in hash
                var l = document.getElementById('sel-left').value;
                var r = document.getElementById('sel-right').value;
                window.location.hash = l + '/' + r;
            };
        }

        // Load slides and initialize
        fetch(DZI_SERVER + '/slides.json').then(function(r) { return r.json(); }).then(function(data) {
            slides = data;

            // Parse from hash or use defaults
            var hash = window.location.hash.replace('#', '');
            var parts = hash ? hash.split('/') : [];
            var leftId = parts[0] || DEFAULT_LEFT;
            var rightId = parts[1] || DEFAULT_RIGHT;

            populateSelect('left', leftId);
            populateSelect('right', rightId);
            createViewer('left', leftId);
            createViewer('right', rightId);
        }).catch(function(err) {
            console.error('Failed to load slides:', err);
            // Fallback: create viewers with defaults
            createViewer('left', DEFAULT_LEFT);
            createViewer('right', DEFAULT_RIGHT);
        });
    })();
</script>

</body>
</html>
