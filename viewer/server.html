<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WSI Server Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      html, body { height: 100%; margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, sans-serif; }
      .bar { display: flex; gap: 10px; align-items: center; padding: 8px 10px; border-bottom: 1px solid #e5e7eb; background: #fafafa; }
      .bar input { flex: 1; min-width: 220px; padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 6px; }
      #osd { width: 100%; height: calc(100% - 48px); }
    </style>
  </head>
  <body>
    <div class="bar">
      <label for="dzi">DZI URL:</label>
      <input id="dzi" type="text" value="http://localhost:8080/dzi/demo_out.dzi" />
      <button id="load">Load</button>
    </div>
    <div id="osd"></div>
    <script>
      const viewer = OpenSeadragon({
        id: "osd",
        prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/images/",
        showNavigator: true,
        tileSources: [],

        // Remove elastic/springy behavior for more direct control
        animationTime: 0.55,          // 10% tighter - still smooth (default: 1.2)
        springStiffness: 13,          // 10% stiffer for snappier drag (default: 6.5)
        visibilityRatio: 1.0,         // Load tiles when fully in view (default: 0.5)
        constrainDuringPan: false,    // Don't constrain during pan for smoother feel
        immediateRender: false,       // Wait for tiles before rendering (default: false)
        blendTime: 0.15,              // Quick fade-in to hide tile loading (default: 0)

        // Gesture settings for more responsive dragging
        gestureSettingsMouse: {
          flickEnabled: true,         // Keep momentum scrolling
          flickMinSpeed: 180,         // Higher threshold to trigger momentum
          flickMomentum: 0.14,        // Slightly tighter momentum decay
          dragToPan: true,
          scrollToZoom: true,
          clickToZoom: true,
          dblClickToZoom: true,
          pinchToZoom: true
        },

        // Touch settings (for mobile)
        gestureSettingsTouch: {
          flickEnabled: true,
          flickMinSpeed: 120,
          flickMomentum: 0.14,
          dragToPan: true,
          scrollToZoom: false,
          clickToZoom: false,
          dblClickToZoom: true,
          pinchToZoom: true
        },

        // Other optimizations
        maxZoomPixelRatio: 2,         // Limit over-zooming
        pixelsPerWheelLine: 60,       // More responsive scroll zoom
        zoomPerScroll: 1.2,           // Zoom amount per scroll
        zoomPerClick: 2.0,            // Zoom amount per click
        minZoomImageRatio: 0.5,       // Allow zooming out more
        maxZoomLevel: 40              // Maximum zoom level
      });

      function load() {
        const url = document.getElementById("dzi").value.trim();
        if (url) viewer.open(url);
      }

      document.getElementById("load").addEventListener("click", load);
      load();
    </script>
  </body>
</html>
